% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/score_expression.R
\name{score_expression}
\alias{score_expression}
\title{Score Expression Data with Prognostic Gene Signatures}
\usage{
score_expression(
  expression,
  reference,
  cancer_type = NULL,
  z_score_cutoff = 2,
  pseudobulk = FALSE,
  group_by = NULL,
  assay = NULL,
  slot = "data",
  use_dataset_info = FALSE,
  dataset = NULL,
  verbose = TRUE
)
}
\arguments{
\item{expression}{Expression data. Can be:
\itemize{
\item Matrix or data.frame (genes x samples/cells)
\item Seurat object
\item SingleCellExperiment object
\item SpatialExperiment object
\item AnnData object (via reticulate)
}}

\item{reference}{Reference dataset name ("precog", "tcga", "pediatric_precog",
"ici_precog") or a custom data.frame with genes as rownames and z-scores
as values}

\item{cancer_type}{Cancer type label. Required if using built-in reference
datasets. Should match column names in reference data. For ICI PRECOG,
use format "ABBREV" or "ABBREV_Metastatic" (e.g., "MELANOMA", "MELANOMA_Metastatic")}

\item{z_score_cutoff}{Absolute z-score threshold for filtering genes
(default: 2)}

\item{pseudobulk}{Logical. If TRUE, aggregate expression before scoring
(default: FALSE)}

\item{group_by}{Column name for pseudobulk grouping. Required if
pseudobulk = TRUE. For Seurat/SCE objects, should be a metadata column.}

\item{assay}{Assay name for Seurat/SCE objects (default: "RNA" for sc,
"Spatial" for spatial)}

\item{use_dataset_info}{Logical. If TRUE, use built-in dataset mapping
(default: FALSE). Requires 'dataset' parameter.}

\item{dataset}{Dataset name for automatic cancer type mapping (optional)}

\item{verbose}{Logical. Print progress messages (default: TRUE)}

\item{slot/layer}{Data layer for Seurat objects: "data" for normalized,
"counts" for raw, "scale.data" for scaled (default: "data").
Note: In Seurat v5+, this uses the 'layer' parameter; in Seurat v4,
this uses the 'slot' parameter. The function handles both automatically.}
}
\value{
A data.frame with samples/cells as rows and score columns. Column
names follow pattern: "weighted_sum_score_{reference}_{cancer_type}"
}
\description{
Calculate weighted sum scores for expression data using prognostic z-scores
from various reference datasets (PRECOG, TCGA, Pediatric, ICI).
}
\examples{
\dontrun{
# Bulk expression matrix
scores <- score_expression(
  expression = bulk_matrix,
  reference = "precog",
  cancer_type = "BRCA"
)

# Single cell Seurat object
scores <- score_expression(
  expression = seurat_obj,
  reference = "tcga",
  cancer_type = "LUAD",
  assay = "RNA",
  slot = "data"
)

# Spatial with pseudobulk
scores <- score_expression(
  expression = spatial_seurat,
  reference = "ici_precog",
  cancer_type = "MELANOMA_Metastatic",
  pseudobulk = TRUE,
  group_by = "sample_id"
)

# Custom reference data
custom_ref <- data.frame(
  row.names = c("TP53", "MYC", "EGFR"),
  my_signature = c(3.2, -2.5, 2.8)
)
scores <- score_expression(
  expression = my_data,
  reference = custom_ref
)
}

}
